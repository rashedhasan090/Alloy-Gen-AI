There is no bug in the specification. The provided code is already correct.