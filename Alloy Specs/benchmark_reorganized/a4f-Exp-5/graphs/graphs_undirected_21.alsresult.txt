pred undirected {
    adj = ~adj
}

... rest of the code is correct as provided ...